# 并发和并行

这篇文档将对并发相关的概念做一个概述，比如什么是并发、什么是并行，这也是非常容易混淆的概念。并发和并行这两个术语是非常容易混淆的，甚至是在很多的编程书籍中也是如此。那么如何理解并发和并行呢？"并行"和"并发"是两个与多任务处理相关的概念，尽管它们经常被一起使用，但在计算机科学中，它们有着不同的含义。

## 并发（Concurrency）{id="Concurrency"}

并发是指系统能够同时处理多个独立的任务。在一个时间段内，系统可以交替地执行多个任务，每个任务在某个时间片内执行一部分，然后切换到下一个任务。虽然在短时间内看起来多个任务在同时执行，但实际上是通过快速的切换在不同任务之间共享CPU时间。并发通常用于提高系统资源的利用率和响应性能，特别是在I/O密集型任务中。

## 并行（Parallelism）{id="Parallelism"}

并行是指系统能够同时执行多个独立的任务，每个任务在不同的物理处理单元（如多核CPU）上独立运行。并行的任务在同一时刻执行，而不是交替执行。并行通常用于提高计算密集型任务的处理速度，通过同时利用多个处理单元来完成更多的工作。

简而言之，区别在于：

* 并发是指在一个时间段内多个任务交替执行，任务之间共享CPU时间，用于提高资源利用率和响应性能。
* 并行是指多个任务在同一时刻独立执行，每个任务在不同的处理单元上运行，用于加速计算密集型任务。

要理解这两个概念，可以用一个例子来说明：想象你在做饭，有一个炉子和一个水槽。如果你同时在炉子上煮饭、在水槽里洗碗，那么你在并发地处理两个任务。而如果你有两个炉子，你可以在同时煮饭和煮汤，这就是并行。

在计算机领域，了解并发和并行的概念对于设计和优化多任务处理和多线程编程都是至关重要的。

Brian Goetz 是《Java 并发编程实战》一书的作者， 在其 2016 年的演讲“From Concurrent to Parallel”中给出了一种合理的说法:

* 并发是指如何正确、高效地控制共享资源
* 并行是指如何利用更多地资源来产生更快速地响应

Bruce Eckel 在 《One Java》一书中指出了并发和并行的区别在于应用场景不同:

* 并发指的是同时处理多个任务，即不必等待一个任务完成就能开始处理其他任务。并发解决的是阻塞问题，即一个任务必须要等待其非可控的外部条件满足后才能继续执行，最常见的例子是 I/O 阻塞。

* 并行指的是同时在多处执行多个任务，解决的是所谓的计算密集型问题，即通过把任务分成多个部分，并在多个处理器上执行，从而提升运行的速度。

所以，在实际的实现中，可以有更细致的分类：

* 纯并发（Purely Concurrent）：多个任务在单 CPU 上运行。存粹并发系统会比时序系统更快地生成结果，但是无法利用多处理器进一步提升性能。比如多进程编程模型。
* 并发式并行（Concurrent-Parallel）：应用并发技术，使程序能利用多处理器实现更高地性能。
* 并行式并发（Parallel-Concurrent）: 使用并行编程技术编写地程序，而且即使只有一个处理器也能运行（Java 8 的 Stream 就是很好的例子）。
* 纯并行（Purely Parallel）：只能在多处理器上运行。


所以 Bruce Eckel 在书中针对并发给出了一个简单的定义: **并发是一系列聚焦于如何减少等待并提升性能的技术**。这里的关键点是“等待”。并且给出了并发四定律:

所以 Bruce Eckel 在书中针对并发给出了一个简单的定义: 

1. 不要使用并发，并且不要自己来做
2. 一切都不可信，一切都很重要
3. 能运行并不代表没问题
4. 你终究要理解并发
